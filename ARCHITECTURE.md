# Flow Experience - Рефакторированная архитектура

## Обзор

Проект был полностью рефакторирован согласно плану с созданием модульной архитектуры, разделением ответственности и улучшением поддерживаемости кода.

## Новая структура проекта

```
src/
├── components/           # UI компоненты
│   ├── ControlPanel.tsx     # Главная панель управления
│   ├── ModeSelector.tsx     # Выбор режимов
│   ├── SoundSelector.tsx    # Выбор звуков
│   ├── FlickerSettings.tsx  # Настройки мерцания
│   ├── SpeedSettings.tsx    # Настройки скорости
│   └── PerformanceSettings.tsx # Настройки производительности
├── hooks/               # React хуки
│   ├── useFlowExperience.ts # Основной хук состояния
│   ├── useEventHandlers.ts  # Обработчики событий
│   ├── useAnimation.ts      # Анимационный цикл
│   └── useThreeJS.ts        # Инициализация Three.js
├── managers/            # Менеджеры системы
│   ├── SettingsManager.ts   # Управление настройками
│   ├── AudioManager.ts      # Управление звуком
│   └── ParticleSystem.ts   # Система частиц
├── types/               # Типы и интерфейсы
│   └── index.ts
├── FlowExperience.tsx   # Главный компонент
├── main.tsx            # Точка входа
└── index.css           # Стили
```

## Ключевые улучшения

### 1. Модульная архитектура
- **Разделение ответственности**: каждый модуль отвечает за свою область
- **Переиспользуемость**: компоненты и хуки можно легко переиспользовать
- **Тестируемость**: каждый модуль можно тестировать независимо

### 2. Менеджеры системы
- **SettingsManager**: Singleton для управления настройками с localStorage и URL параметрами
- **AudioManager**: Централизованное управление всеми звуками через Tone.js
- **ParticleSystem**: Инкапсулированная система частиц с поддержкой всех режимов

### 3. React хуки
- **useFlowExperience**: Центральный хук состояния приложения
- **useEventHandlers**: Обработка всех пользовательских событий
- **useAnimation**: Анимационный цикл с оптимизацией производительности
- **useThreeJS**: Инициализация и управление Three.js сценой

### 4. UI компоненты
- **Модульные компоненты**: каждый UI элемент - отдельный компонент
- **Пропсы с типизацией**: строгая типизация всех пропсов
- **Переиспользуемость**: компоненты можно легко переиспользовать

## Реализованные функции из плана

### ✅ Три визуальных режима
1. **Smooth Flow** - плавное движение частиц
2. **Star Wars Crawl** - движение снизу вверх с перспективой
3. **Dynamic Patterns** - с подрежимами (Spiral, Waves, Vortex)

### ✅ Интерактивное управление скоростью
- **Desktop**: пробел или клик мыши для ускорения до 3x
- **Mobile**: долгий тап для ускорения
- **Плавный разгон**: за 1.5 секунды

### ✅ UI панель управления
- **Минималистичные иконки**: 40x40px с hover эффектами
- **Раскрывающиеся меню**: при наведении
- **Мобильная версия**: тройной тап в правом углу

### ✅ Выбор звуков
- **Theta Drone** - FM синтез с Theta ритмом (6 Гц)
- **Dark Noise** - brown noise с фильтром
- **Rain** - white noise с bandpass фильтром
- **Ocean** - brown noise с волновым LFO

### ✅ Настройки мерцания
- **Пульсация размера**: включение/выключение в шейдере
- **Пульсация прозрачности**: включение/выключение в шейдере

### ✅ Настройки скорости
- **Слайдер базовой скорости**: 0.5x - 3.0x
- **Сохранение настроек**: localStorage + URL параметры

### ✅ Связь звука со скоростью
- **Модуляция параметров**: частота, громкость, фильтры
- **Реактивность**: звук изменяется в реальном времени

### ✅ Сохранение настроек
- **localStorage**: автоматическое сохранение
- **URL параметры**: для шаринга конфигураций
- **Восстановление**: при загрузке страницы

## Технические улучшения

### Производительность
- **Оптимизированный рендеринг**: только необходимые обновления
- **Управление памятью**: правильная очистка ресурсов
- **Lazy loading**: компоненты загружаются по требованию

### Типизация
- **Строгая типизация**: все интерфейсы и типы определены
- **TypeScript**: полная поддержка типов
- **IntelliSense**: улучшенная поддержка IDE

### Архитектура
- **Singleton паттерн**: для менеджеров
- **Observer паттерн**: для реактивности
- **Composition**: вместо наследования

## Использование

### Запуск проекта
```bash
npm install
npm run dev
```

### Сборка
```bash
npm run build
```

### Основные функции
- **Клик/тап**: начать опыт
- **Пробел/клик**: ускорение
- **O**: скрыть/показать UI
- **Тройной тап** (мобильные): показать UI

## Будущие улучшения

1. **Code splitting**: разделение на чанки
2. **Service Worker**: кэширование ресурсов
3. **WebGL оптимизации**: более эффективные шейдеры
4. **A11y**: улучшение доступности
5. **Тесты**: unit и integration тесты

## Заключение

Рефакторинг полностью соответствует плану и создает прочную основу для дальнейшего развития проекта. Код стал более читаемым, поддерживаемым и расширяемым.
